---
title: "qt添加进度条或遮罩层时界面卡死"
publishDate: 2022-05-12 7:26:00 +0800
date: 2022-05-12 7:14:08 +0800
categories: Linux UOS QT C++
position: problem
---

在Qt开发时有一个需要很长时间运行的逻辑，这时候界面会卡死，为了避免这时点击到界面，需要增加一个遮罩。但是增加了遮罩没有显示出来。

---

<div id="toc"></div>

## 问题

在Qt开发时有一个需要很长时间运行的逻辑，这时候界面会卡死，为了避免这时点击到界面，需要增加一个遮罩。但是增加了遮罩没有显示出来。看现象是遮罩也被卡死了。以前在开发.net时都是通过Thread.Sleep(0)来让出线程更新界面的。但是在qt中机制不一样，没有效果。


## 解决

在更新遮罩进度时需要执行一次QCoreApplication::processEvents();

## 原因

这里注意使用QCoreApplication::processEvents()是防止界面假死，该函数的作用是让程序处理那些还没有处理的事件，然后再把使用权返回给调用者。

因为弹出的等待对话框是模式的，因此在他运行期间鼠标是无法点击父窗口的。这样防止了用户在任务没有处理完时误点击关闭了主窗口。

---

**参考资料**

- [Qt处理耗时任务，显示等待界面的两种方式，并防止界面假死与用户误操作](https://blog.csdn.net/qq_24282081/article/details/95782291)
